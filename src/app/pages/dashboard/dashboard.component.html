<div class="dashboard">

  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <span class="title">Soldados do Rei</span>
    </div>

    <div class="header-actions">
      <button mat-icon-button [matMenuTriggerFor]="userMenu" class="avatar-btn" aria-label="Usuário">
        <img *ngIf="currentUser?.avatarUrl; else dashIcon" [src]="currentUser.avatarUrl" class="avatar-img" alt="avatar">
        <ng-template #dashIcon>
          <mat-icon>account_circle</mat-icon>
        </ng-template>
      </button>

      <mat-menu #userMenu="matMenu">
        <button mat-menu-item (click)="goToProfile()">Perfil</button>
        <button mat-menu-item (click)="logout()">Sair</button>
      </mat-menu>
    </div>
  </header>



  <!-- Conteúdo -->
  <main class="content">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <h1>Painel</h1>
      <div *ngIf="hasRole('CONSELHEIRO')" class="unidade-points">
        <span class="icon"><mat-icon>emoji_events</mat-icon></span>
        <span class="text">{{ unidadePoints ?? '—' }} pts</span>
      </div>
    </div>
    
    <div style="display:flex; align-items:center; gap:1rem; margin-bottom: 1rem;">
      <p class="subtitle" style="margin:0">Bem-vindo ao sistema do clube</p>
    </div>

    <div class="cards">
      <!-- Ordem por importância: Cadastro, Classes, Unidades, Placar, Atrasados, Textos Bíblicos, Usuários -->

      <!-- Cadastro de Desbravadores (Admin + Secretaria) -->
      <div class="card" *ngIf="hasRole('ADMIN') || hasRole('SECRETARIA')" (click)="goToCadastroDesbravadores()" style="cursor: pointer;">
        <div class="card-icon"><mat-icon>person_add</mat-icon></div>
        <div>
          <h2 title="Cadastro Desbravadores">Cadastro Desbravadores</h2>
          <p title="Cadastrar desbravadores e atribuir unidades">Cadastrar desbravadores e atribuir unidades</p>
        </div>
      </div>

      <!-- Classes (Instrutor) -->
      <div class="card" *ngIf="hasRole('INSTRUTOR')" (click)="goToClasses()" style="cursor: pointer;">
        <div class="card-icon"><mat-icon>groups</mat-icon></div>
        <div>
          <h2 title="Classes">Classes</h2>
          <p title="Gerencie as classes dos desbravadores">Gerencie as classes dos desbravadores</p>
        </div>
      </div>

      <!-- Unidades (Conselheiro) -->
      <div class="card" *ngIf="hasRole('CONSELHEIRO')" (click)="goToUnidades()" style="cursor: pointer;">
        <div class="card-icon"><mat-icon>flag</mat-icon></div>
        <div>
          <h2 title="Unidades">Unidades</h2>
          <p title="Organização das unidades">Organização das unidades</p>
        </div>
      </div>

      <div class="card" *ngIf="hasRole('ADMIN') || hasRole('CONSELHEIRO')" (click)="goToDesafioUnidades()" style="cursor: pointer;">
        <div class="card-icon"><mat-icon>emoji_events</mat-icon></div>
        <div>
          <h2 title="Desafio das Unidades">Desafio das Unidades</h2>
          <p title="Criar, submeter e aprovar desafios por unidade">Criar, submeter e aprovar desafios por unidade</p>
        </div>
      </div>

      <!-- Placar de Mérito (Admin) -->
      <div class="card" *ngIf="hasRole('ADMIN')" (click)="goToMerito()" style="cursor: pointer;">
        <div class="card-icon"><mat-icon>leaderboard</mat-icon></div>
        <div>
          <h2 title="Placar de Mérito">Placar de Mérito</h2>
          <p title="Ver ranking completo de mérito por classe e pontos">Ver ranking completo de mérito por classe e pontos</p>
        </div>
      </div>

      <!-- Atrasados (Admin) -->
      <div class="card" *ngIf="hasRole('ADMIN')" (click)="goToAtrasados()" style="cursor: pointer;">
        <div class="card-icon"><mat-icon>schedule</mat-icon></div>
        <div>
          <h2 title="Atrasados">Atrasados</h2>
          <p title="Marcar desbravadores atrasados do dia">Marcar desbravadores atrasados do dia</p>
        </div>
      </div>

      <!-- Textos Bíblicos (Admin + Conselheiro) -->
      <div class="card" *ngIf="hasRole('ADMIN') || hasRole('CONSELHEIRO')" (click)="goToTextosBiblicos()" style="cursor: pointer;">
        <div class="card-icon"><mat-icon>menu_book</mat-icon></div>
        <div>
          <h2 title="Textos Bíblicos">Textos Bíblicos</h2>
          <p title="Enviar e gerenciar textos bíblicos (aprovadores veem toda a fila)">Enviar e gerenciar textos bíblicos (aprovadores veem toda a fila)</p>
        </div>
      </div>

      <!-- Usuários (Admin + Secretaria) -->
      <div class="card" *ngIf="hasRole('ADMIN') || hasRole('SECRETARIA')" (click)="goToUsers()" style="cursor: pointer;">
        <div class="card-icon"><mat-icon>people</mat-icon></div>
        <div>
          <h2>Usuários</h2>
          <p>Controle de acesso</p>
        </div>
      </div>
    </div>
  
    <div style="display: flex; justify-content: center; margin-top: 2rem; flex-direction: column; align-items: center;">
         <section class="graficos-section">
        <div *ngIf="showTabs" class="tabs">
          <button *ngFor="let tab of availableTabs" type="button" class="tab" [class.active]="selectedTab === tab.key"
            (click)="selectTab(tab.key)">
            {{ tab.label }}
          </button>
        </div>

      </section>
      <div class="tab-panels">
        <app-admin-graficos *ngIf="selectedTab === 'admin'"></app-admin-graficos>
        <app-instrutor-graficos *ngIf="selectedTab === 'instrutor'"></app-instrutor-graficos>
        <app-conselheiro-graficos *ngIf="selectedTab === 'conselheiro'"></app-conselheiro-graficos>
      </div>
    </div>
  
  </main>

</div>